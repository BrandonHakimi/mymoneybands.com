<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mymoneybands | Dashboard</title>
</head>
<script type = "text/javascript">  //This script should contain all js code for now
                                   //We can place functions in different files later
//HEAD
//import Chart from 'chart.js/auto'


var FirstName;
var LastName;


var Name;

var MonthlyIncome;
var Budget;
var TotalBills = 0;
var MoneyLeft;
var Choice;
//var Continue;
var Temp;

var ArrayPositionTracker = 0;
const InputArray = [];

//*********************************************************************************************************

function setCookie(cname,cvalue,exdays) {
  const d = new Date();
  d.setTime(d.getTime() + (exdays*24*60*60*1000));
  let expires = "expires=" + d.toUTCString();
  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}

function getCookie(cname) {
  let name = cname + "=";
  let decodedCookie = decodeURIComponent(document.cookie);
  let ca = decodedCookie.split(';');
  for(let i = 0; i < ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}

function checkCookie() {
    let user = getCookie("username");
    if (user != "") {
    alert("Welcome again, " + user);
    } else {
        user = prompt("Please enter your name:","");
        if (user != "" && user != null) {
            setCookie("username", user, 30);
        }
    }
    Name = user;
}

//*********************************************************************************************************

function Initialize() {
    FirstName = prompt("What is your first name?");
    LastName = prompt("What is your last name?");
    var MonthlyTest = false;
    while (MonthlyTest === false) {
        MonthlyIncome  = prompt("What is your Projected Income for this month?");
        if(isNaN(MonthlyIncome)) {
            window.alert("Invalid Input, please enter a number.");
        } else {
            MonthlyTest = true;
        }
    }
    var BudgetTest = false;
    while (BudgetTest === false) {
        Budget = prompt("What is your budget for this month?");
        if(isNaN(Budget)) {
            window.alert("Invalid Input, please enter a number.");
        } else {
            BudgetTest = true;
        }
    }
    window.alert(`Hello, ${FirstName} ${LastName}. Your projected income for this month is $${MonthlyIncome}. You have set your budget at $${Budget}.`);
}

function InputBills() {
    if (MonthlyIncome === undefined) {
        window.alert("You do not have any data with MyMoneyBands, please select the Initialize button first.");
    } else {
        do {
            var BillName = prompt("Who is this Bill due to? (Company or Label)");
            var BillValue;
            var BillTest = false;
            while (BillTest === false) {
                BillValue = prompt("What is the Payment Amount for this Bill?");
                if(isNaN(BillValue)) {
                    window.alert("Invalid Input, please enter a number.");
                } else {
                    BillTest = true;
                }
            }
            var BillDate = prompt("What is the date that this Bill is due?");
            var RecurringChoice = prompt("Is this Bill a monthly recurring charge?");
            var RecuringCaps = RecurringChoice.toUpperCase();
            var RecurringFlag;
            if (RecuringCaps === "Y" || RecuringCaps === "YE" || RecuringCaps === "YES" || RecuringCaps === "YA" || RecuringCaps === "YEAH" || RecurringChoice === 1) {
                RecurringFlag = true;
                window.alert(`You have input a Bill due to ${BillName} that will charge you $${BillValue} due on ${BillDate}. This Bill is a recurring charge.`);
                InputArray[ArrayPositionTracker] = new Array("BL", BillName, BillValue, BillDate, RecurringFlag);
                ArrayPositionTracker++;
            } else {
                RecurringFlag = false;
                window.alert(`You have input a Bill due to ${BillName} that will charge you $${BillValue} due on ${BillDate}. This Bill is not a recurring charge.`);
                InputArray[ArrayPositionTracker] = new Array("BL", BillName, BillValue, BillDate, RecurringFlag);
                ArrayPositionTracker++;
            }
            var Continue = prompt("Are there any more bills you wish to input?");
            var ContinueCaps = Continue.toUpperCase();
        } while (ContinueCaps === "Y" || ContinueCaps === "YE" || ContinueCaps === "YES" || ContinueCaps === "YA" || ContinueCaps === "YEAH" || Continue === 1);
    }
}

function InputTransactions() {
    if (MonthlyIncome === undefined) {
        window.alert("You do not have any data with MyMoneyBands, please select the Initialize button first.");
    } else {
        do {
            var TransactionTitle = prompt("What did you spend your money on?");
            var TransactionCost;
            var TransactionTest = false;
            while (TransactionTest === false) {
                TransactionCost = prompt("How much did this transaction cost?");
                if(isNaN(TransactionCost)) {
                    window.alert("Invalid Input, please enter a number.");
                } else {
                    TransactionTest = true;
                }
            }
            window.alert(`You have input a Transaction for ${TransactionTitle} that cost you $${TransactionCost}.`);
            InputArray[ArrayPositionTracker] = new Array("TR", TransactionTitle, TransactionCost, "NULL", "NULL");
            ArrayPositionTracker++;
            var Continue = prompt("Are there any more Transactions you would like to input?");
            var ContinueCaps = Continue.toUpperCase();
        } while (ContinueCaps === "Y" || ContinueCaps === "YE" || ContinueCaps === "YES" || ContinueCaps === "YA" || ContinueCaps === "YEAH" || Continue === 1);
    }
}

//*********************************************************************************************************

function InputSpending() {
    if (Budget === undefined) {
        window.alert("No data, please use Initialize button to set up necessary data for the month first.");
    } else {
        window.alert(`Hello ${Name}, you have a budget of $${Budget} and a total income of $${MonthlyIncome} which leaves you with $${MoneyLeft} to spend on other things.`);
        while(1)    {
            Continue = prompt("Would you like to input a transaction?");
            var ContinueCaps = Continue.toUpperCase();
                if (ContinueCaps === "Y" || ContinueCaps === "YE" || ContinueCaps === "YES" || ContinueCaps === "YA" || ContinueCaps === "YEAH" || Continue === 1) {
                    var Transaction = prompt("How much was this transaction?");
                    if(isNaN(Transaction))
                         window.alert("Invalid Input, please enter a number.");
                        else
                        MoneyLeft -= Transaction;
                }
            else if (ContinueCaps === "N" || ContinueCaps == "NO" || ContinueCaps == "NAW" || ContinueCaps == "NAH" || Continue === 0) {
                break;
            }
        }
    }
}

function CalculateMonthlySum() {
    //Calculate functions, which will lead to output/display and financial advisement

    //iterate over InputArray[i][2] for money

    //iterate over InputArray[i][1] for category
    var sum = 0;
    for (var i = 0; i < InputArray.length; i++){
        if(isNaN(temp) === false){
            let temp = parseFloat(InputArray[i][2]);
            sum += temp;
        }
    }

    window.alert(sum);
}

function TestArray() {
    for (var i = 0; i < InputArray.length; i++) {
        for (var j = 0; j < 5; j++) {
            window.alert(`${i},${j}: ${InputArray[i][j]}`);
        }
    }
            window.alert("This is a test in the array function");
}

/*function CalculateCategoryPercent() {



} */



/*function TestChart() {
  const data = [
    { year: 2010, count: 10 },
    { year: 2011, count: 20 },
    { year: 2012, count: 15 },
    { year: 2013, count: 25 },
    { year: 2014, count: 22 },
    { year: 2015, count: 30 },
    { year: 2016, count: 28 },
  ];

  new Chart(
    document.getElementById('acquisitions'),
    {
      type: 'bar',
      data: {
        labels: data.map(row => row.year),
        datasets: [
          {
            label: 'Acquisitions by year',
            data: data.map(row => row.count)
          }
        ]
      }
    }
  );
};*/

</script>

<body> 
    <div>
        <canvas id="myChart"></canvas>
      </div>
      <!--<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>!-->
    <header>
        <h1>MyMoneyBands</h1>
    </header>
    <nav>
        <h2>
            <h3>Welcome to MyMoneyBands!</h3>
            <br>
            <input type ="button" onclick = "Initialize()" value = "Initialize">
            <input type ="button" onclick = "checkCookie()" value = "Cookie Test Button">
            <input type ="button" onclick = "InputTransactions()" value = "Input Transactions">
            <input type ="button" onclick = "InputBills()" value = "Input Bills">
            <br>
            <br>
            <input type ="button" onclick = "TestArray()" value = "TestArray (Print all)">
            <br>
            <br>
            <input type ="button" onclick = "CalculateMonthlySum()" value = "Calculate Monthly Sum">
            <br>
            <!--<input type ="button" onclick = "TestChart()" value = "Graph Test Button">!-->

            <br>
        </h2>
    </nav>  
</body>
</html>
